<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Pleasant Vacation - Hub</title>
    </head>
    <body>
        <h1>Hub</h1>

        <div id="trips">

        </div>

        <span th:text="${serverTime}" />

        <script>
            const tripTemplate = `
    <div class="trip">
        <h3 class="trip-header">Trip</h3>
        <p class="trip-description"></p>
    </div>
`;

            Element.prototype.getFirstElementByClassName = function (className) {
                return this.getElementsByClassName(className)[0];
            };

            function fromHTML(html, trim = true) {
                // Process the HTML string.
                html = trim ? html.trim() : html;
                if (!html) return null;

                // Then set up a new template element.
                const template = document.createElement('template');
                template.innerHTML = html;
                const result = template.content.children;

                // Then return either an HTMLElement or HTMLCollection,
                // based on whether the input HTML had one or more roots.
                if (result.length === 1) return result[0];
                return result;
            }

            async function getTrips(page = 0) {
                let trips;

                await fetch(window.location.origin + "/hub/trips?page=" + page + "&elementsInPage=10")
                    .then(res => res.json())
                    .then(data => trips = data);

                return trips;
            }

            async function makeTripList() {
                let trips = await getTrips();
                console.log(trips);

                for (const trip of trips) {
                    const newDiv = fromHTML(tripTemplate);

                    newDiv.getFirstElementByClassName("trip-description").innerText = trip.description;
                    newDiv.getFirstElementByClassName("trip-header").innerText = trip.name;

                    document.getElementById("trips").appendChild(newDiv);
                }
            }

            window.onload = async function () {
                await makeTripList();
            }
        </script>
    </body>
</html>